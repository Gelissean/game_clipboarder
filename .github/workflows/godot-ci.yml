name: "godot-ci export"
on:
  push:
    branches:
    - main
  pull_request:
    branches:
    - main
  
env:
  GODOT_VERSION: 4.1.3
  EXPORT_NAME: clipboarder

jobs:
  export-windows:
    name: Windows Export
    runs-on: ubuntu-20.04
    container:
      image: barichello/godot-ci:4.1.3
    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.1
        with:
          lfs: true
      - name: Setup
        run: |
          mkdir -v -p ~/.local/share/godot/export_templates
          mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/export_templates/${GODOT_VERSION}.stable
      - name: Windows Build
        run: |
          pwd
          mkdir -v -p /build/windows
          godot --headless --verbose --export-release "Windows Desktop" /build/windows/$EXPORT_NAME.exe
          cd /build/windows
          ls -l
      - name: Upload Artifact
        uses: actions/upload-artifact@v4.0.0
        with:
          name: windows
          path: /build/windows/
      - name: GitHub Tag
        # You may pin to the exact commit or the version.
        # uses: mathieudutour/github-tag-action@fcfbdceb3093f6d85a3b194740f8c6cec632f4e2
        uses: mathieudutour/github-tag-action@v6.1
        with:
          # Required for permission to tag the repo.
          github_token: ${{ secrets.RELEASE_TOKEN }}
          # Custom tag name. If specified, it overrides bump settings.
          custom_tag: latest
      - name: Upload to Release Action
        # You may pin to the exact commit or the version.
        # uses: Shopify/upload-to-release@c77c9b3e5d288adaef98a7007bf92340ec6ce03b
        uses: Shopify/upload-to-release@v2.0.0
        with:
          # Artifact name
          name: windows
          # Path to the file to upload
          path: /build/windows
          # secrets.GITHUB_TOKEN
          repo-token: ${{ secrets.RELEASE_TOKEN }}

